<div class="highlight"><pre><span class="k">def</span> <span class="nf">+</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">create_dummy_nmatrix</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">NMatrix</span><span class="p">))</span>
    <span class="c1">#check dimension</span>
    <span class="k">raise</span><span class="p">(</span><span class="no">ShapeError</span><span class="p">,</span> <span class="s2">&quot;Cannot add matrices with different dimension&quot;</span><span class="p">)\</span>
    <span class="k">if</span> <span class="p">(</span><span class="vi">@dim</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="c1">#check shape</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="k">raise</span><span class="p">(</span><span class="no">ShapeError</span><span class="p">,</span> <span class="s2">&quot;Cannot add matrices with different shapes&quot;</span><span class="p">)</span> <span class="p">\</span>
      <span class="k">if</span> <span class="p">(</span><span class="vi">@shape</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">result</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="vi">@s</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">result</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="vi">@s</span><span class="o">.</span><span class="n">copy</span><span class="o">.</span><span class="n">mapAddToSelf</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">result</span>
<span class="k">end</span>
</pre>
</div>
